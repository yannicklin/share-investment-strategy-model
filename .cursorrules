# Cursor AI Rules for ASX AI Trading System

## üéØ MANDATORY: Read SOUL.md First

**Before making ANY code changes, read SOUL.md to understand:**
- Project philosophy and core values (Data-Driven, Realism, Transparency)
- Architectural principles (Modularity, Factory Pattern, Consensus Logic)
- Security-first mindset and financial safety standards
- Development journey and lessons learned
- Code attribution requirements

**All contributions MUST align with SOUL.md principles. Non-compliance = rejected work.**

---

## Project Context

**Name**: ASX AI Trading Strategy System  
**Type**: Python/Streamlit Machine Learning Application  
**Purpose**: Multi-model AI trading strategy analysis with realistic backtesting

**Stack**:
- **Backend**: Python 3.x, pandas, scikit-learn, yfinance
- **ML Models**: Random Forest, XGBoost, CatBoost, Prophet, LSTM (5 algorithms)
- **Frontend**: Streamlit dashboard with segmented views
- **Data**: Yahoo Finance (ASX tickers with .AX suffix)

---

## Development Workflow

### 1. Documentation-First Development

**ALWAYS follow this sequence:**

1. **UPDATE REQUIREMENTS**: Modify `asx_ai_trading_system_requirements.md` first
2. **ANALYZE CHANGES**: Understand impact on existing features
3. **IMPLEMENT**: Code with proper documentation
4. **TEST**: Validate with real ASX ticker data
5. **DOCUMENT HEADERS**: Add copyright headers to new files

**NEVER start coding without updating requirements documentation first.**

---

## Core Mandates

### 1. Preserve Backtesting Realism

**CRITICAL**: Never compromise realistic constraints for better-looking results

**Must Include**:
- ‚úÖ CMC Markets fees: max($11, 0.10% √ó trade value)
- ‚úÖ ATO 2024-25 tax brackets with 50% CGT discount
- ‚úÖ Price gap handling for stop-loss (open price check)
- ‚úÖ T+1 reinvestment logic (no same-day reallocation)
- ‚úÖ 2-decimal precision for ROI/Win Rate (no false precision)

**Forbidden**:
- ‚ùå Removing fee calculations
- ‚ùå Ignoring tax implications
- ‚ùå Perfect fills at exact stop-loss prices
- ‚ùå Immediate capital reinvestment
- ‚ùå Excessive decimal precision (>2 places)

---

### 2. Maintain Multi-Model Consensus

**Architecture**: Factory pattern with 5 independent models

**Must Preserve**:
- ‚úÖ Majority vote consensus (‚â•3/5 models for signal)
- ‚úÖ Tie-breaker mechanism (user-selectable model)
- ‚úÖ Individual model availability checks (XGB/CatBoost/Prophet/LSTM optional)
- ‚úÖ Standardized prediction interface across all models

**Forbidden**:
- ‚ùå Hardcoding single model
- ‚ùå Removing consensus logic
- ‚ùå Breaking model availability checks
- ‚ùå Inconsistent prediction formats

---

### 3. Data Integrity Standards

**Yahoo Finance Integration**:
- ‚úÖ Use `.AX` suffix for all ASX tickers
- ‚úÖ Use `auto_adjust=True` for historical data
- ‚úÖ Use `Close` column (not `Adj Close`) for all calculations
- ‚úÖ Implement RSI, MACD, Moving Averages as standard features

**Preprocessing**:
- ‚úÖ Support both `StandardScaler` and `RobustScaler`
- ‚úÖ Handle missing data gracefully
- ‚úÖ Validate ticker format before API calls

---

### 4. Security & Safety

**CRITICAL**:
- ‚ùå NEVER commit API keys or credentials
- ‚ùå NEVER make financial claims without disclaimers
- ‚úÖ ALWAYS validate user inputs
- ‚úÖ ALWAYS implement safe defaults
- ‚úÖ ALWAYS test with real ASX data

**Disclaimers**:
```python
# Example for UI components
st.warning("‚ö†Ô∏è For educational purposes only. Not financial advice.")
```

---

### 5. Code Attribution

**All new Python files MUST include copyright header:**

```python
"""
ASX AI Trading System - [Module Name]

Purpose: [Brief description of module's functionality]

Author: Yannick
Created: January 2026
Copyright (c) 2026 Yannick
"""
```

**See**: `CODE_HEADERS.md` for detailed templates

---

## File Structure Rules

```
share-investment-strategy-model/
‚îú‚îÄ‚îÄ ASX_AImodel.py          # Main Streamlit app (DO NOT refactor heavily)
‚îú‚îÄ‚îÄ core/                   # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Configuration dataclass
‚îÇ   ‚îú‚îÄ‚îÄ model_builder.py   # AI model factory
‚îÇ   ‚îú‚îÄ‚îÄ backtest_engine.py # Backtesting engine
‚îÇ   ‚îî‚îÄ‚îÄ index_manager.py   # Index constituent management
‚îú‚îÄ‚îÄ ui/                     # Streamlit components
‚îÇ   ‚îú‚îÄ‚îÄ sidebar.py         # Mode selection + parameters
‚îÇ   ‚îú‚îÄ‚îÄ algo_view.py       # Models comparison view
‚îÇ   ‚îú‚îÄ‚îÄ strategy_view.py   # Time-span comparison view
‚îÇ   ‚îú‚îÄ‚îÄ stars_view.py      # Super stars scanner view
‚îÇ   ‚îî‚îÄ‚îÄ components.py      # Reusable UI components
‚îî‚îÄ‚îÄ tests/                  # Unit tests
```

**Separation Rules**:
- ‚úÖ Keep business logic in `core/`
- ‚úÖ Keep UI logic in `ui/`
- ‚ùå Don't mix UI and business logic
- ‚ùå Don't create new top-level directories without justification

---

## Code Style

### Python Standards

- **PEP 8**: Follow Python style guidelines
- **Type Hints**: Use for function signatures
- **Docstrings**: Required for all public functions
- **Imports**: Organize (stdlib ‚Üí third-party ‚Üí local)

**Example**:
```python
from typing import List, Dict, Optional
import pandas as pd

def calculate_roi(
    initial_capital: float,
    final_capital: float
) -> float:
    """
    Calculate return on investment as percentage.
    
    Args:
        initial_capital: Starting capital (AUD)
        final_capital: Ending capital (AUD)
    
    Returns:
        ROI as percentage (2 decimal precision)
    """
    return round(((final_capital - initial_capital) / initial_capital) * 100, 2)
```

---

## Testing Requirements

**Before Committing**:
1. ‚úÖ Test with real ASX tickers (e.g., CBA.AX, BHP.AX)
2. ‚úÖ Verify all 3 modes work (Models, Time-Span, Super Stars)
3. ‚úÖ Check performance with ASX 50/200 indices
4. ‚úÖ Validate fee/tax calculations produce realistic results
5. ‚úÖ Ensure consensus logic produces sensible recommendations

**Unit Tests**:
```bash
pytest tests/test_core.py
```

---

## Common Tasks

### Adding New Model Algorithm

1. **Update** `asx_ai_trading_system_requirements.md` (new model section)
2. **Import** with availability check in `model_builder.py`
3. **Add** to `Config.model_types` default list
4. **Implement** factory method following existing pattern
5. **Test** with real ASX ticker data
6. **Update** README.md features list

### Adding New Technical Indicator

1. **Update** `asx_ai_trading_system_requirements.md` (indicators section)
2. **Add** calculation in `ModelBuilder._compute_features()`
3. **Ensure** consistent naming (lowercase_snake_case)
4. **Test** with various market conditions
5. **Document** in docstring

### Modifying Backtesting Logic

1. **CRITICAL**: Review SOUL.md "Lessons Learned" first
2. **Maintain** all realistic constraints (fees, taxes, gaps, T+1)
3. **Test** edge cases (stop-loss triggering, zero trades, etc.)
4. **Verify** performance metrics accuracy (ROI, Win Rate)
5. **Document** changes in requirements doc

---

## References

- **[SOUL.md](SOUL.md)** - Project philosophy and values (READ FIRST)
- **[AUTHORS.md](AUTHORS.md)** - Contributors and credits
- **[CODE_HEADERS.md](CODE_HEADERS.md)** - Attribution templates
- **[AGENTS.md](AGENTS.md)** - AI development guidelines
- **[asx_ai_trading_system_requirements.md](asx_ai_trading_system_requirements.md)** - Technical specifications

---

## Anti-Patterns to Avoid

‚ùå **Don't**:
- Remove fee/tax calculations
- Hardcode single model predictions
- Ignore consensus logic
- Mix UI and business logic
- Commit without testing with real data
- Add dependencies without justification
- Make financial claims without disclaimers
- Violate SOUL.md principles

‚úÖ **Do**:
- Update requirements documentation first
- Preserve backtesting realism
- Test with real ASX tickers
- Add proper copyright headers
- Follow existing architectural patterns
- Validate user inputs
- Include safety disclaimers

---

**Last Updated**: January 29, 2026  
**Copyright**: (c) 2026 Yannick  
**License**: MIT
